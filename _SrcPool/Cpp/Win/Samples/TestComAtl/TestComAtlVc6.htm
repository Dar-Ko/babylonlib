<html lang="en-ca">

<!--/* Group=Papers*/ -->

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 5.0" />
<meta name="ProgId" content="FrontPage.Editor.Document" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="en-ca" />
<meta name="Workfile" content="$Workfile: TestComAtlVc6.htm$: documentation" />
<meta name="Revision" content="$Revision: 9$" />
<meta name="robots" content="index" />
<meta name="keywords" content="compiler, ATL, COM" />
<!-- Dublin Core Metadata Package -->
<meta name="DC.title" content="Creating ATL COM Project with Visual C++ 6.0" />
<meta name="DC.creator" content="Darko Kolaković" />
<meta name="DC.creator.vCard.EMAIL.internet" content="DarkoKolakovic @ yahoo" />
<meta name="DC.Contributor" content="$Author: Darko$" />
<meta name="DC.Rights" content="© CommonSoft Inc" />
<meta name="DC.subject" content="ATL COM" />
<meta name="DC.description.abstract" content="COM project setup" />
<meta name="DC.publisher" content="CommonSoft Incorporated" />
<meta name="DC.date" content="$Date: 2007-03-11 14:13:55$" />
<meta name="DC.type" content="Text.Article" />
<meta name="DC.format" content="application/html" />
<meta name="DC.language" content="en_ca" />
<meta name="DC.identifier.Revision" content="$Revision: 9$" />
<meta name="DC.relation.HasVersion" content="http://babylonlib.cvs.sourceforge.net/babylonlib" />
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
<link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" type="text/css" href="../../../../../Doc/Res/KDocument.css" />
<link rel="icon" href="../../../../../Doc/Res/KBook.ico" type="image/ico" />
<title>Creating ATL COM Project with Visual C++ 6.0</title>
<base target="_self" />
<style type="text/css">
    dt
      {
      font-weight: bold;
      }
    table
      {
      border-collapse: collapse;
      }
    body
      {
      background-image: url('../../../../../Doc/Res/KBckgGray.jpg');
      }
  </style>
</head>

<body>

<h1>Creating an ATL COM project with Visual C++ 6.0</h1>
<p>See also: <a href="../TestComAtlNet/TestComAtlVc7.htm">Creating an ATL</a>
<a href="#Footnote1"><sup class="Footnote">1</sup></a>
<a href="../TestComAtlNet/TestComAtlVc7.htm">COM</a><a href="#Footnote2">
<sup class="Footnote">2</sup></a><a href="../TestComAtlNet/TestComAtlVc7.htm">
project with Visual Studio .Net 2003 v7.1</a>
<img border="0" src="../../../../../Doc/Symbol/extern.gif" width="14" height="22"></p>
<ol>
  <li>Select new &quot;ATL COM AppWizard&quot; project:<br />
  <img border="0" src="Res/ComAtlVc61.gif" width="561" height="142" /></li>
  <li>Type desired project name</li>
  <li>Choose <span id="intelliTXT">&quot;Dynamic Link Library&quot; as a Server Type<br />
  <img border="0" src="Res/ComAtlVc62.gif" width="263" height="120" /></span></li>
  <li>After finishing with the wizard, the result will be displayed:<br />
  <img border="0" src="Res/ComAtlVc63.gif" width="413" height="250" /><img border="0" src="Res/ComAtlVc64.gif" width="103" height="277" /></li>
  <li>To add new ATL object, in Workspace view, select ClassView and after right
  mouse click, chose &#39;New ATL Object&#39; in pop-up menu:<br />
  <img border="0" src="Res/ComAtlVc65.gif" width="339" height="171" /></li>
  <li>Add Simple Object:<br />
  <img border="0" src="Res/ComAtlVc67.gif" width="413" height="264" /></li>
  <li>Insert the name for the object and its attributes<br />
  <img border="0" src="Res/ComAtlVc68.gif" width="421" height="286" /><br />
  The result will be presented in the ClassView:<br />
  <img border="0" src="Res/ComAtlVc69.gif" width="164" height="66" /></li>
  <li>Add new method to the created object<br />
  <img border="0" src="Res/ComAtlVc6A.gif" width="366" height="264" /><br />
  and change default implementation of the newly added method:<br />
  <code><br />
  STDMETHODIMP CTestAtlObj::TestMethod(long lInput, long* pResult)<br />
  {<br />
  *pResult = 2 * lInput;<br />
  return S_OK;<br />
  }</code></li>
  <li>Build the project. The compiler will register your new COM DLL so it could
  be used by container application. To unregister the COM server use command
  <code>regsvr32 /u ComName</code>.<ul>
    <li>To access the object remotely Proxy/Stub DLL is also required. In
    project setting create a new Post-build <a href="TestComAtl.txt">
    <img border="0" src="../../../../../Doc/Symbol/externS.gif" width="8" height="8"></a> command <code>nmake&nbsp;-f&nbsp;TestComAtlps.mk</code>.
    The make file .mk <a href="TestComAtlps.mk">
    <img border="0" src="../../../../../Doc/Symbol/externS.gif" width="8" height="8"></a> is created by the ATL COM AppWizard.<br>
    <img border="0" src="Res/ComAtlVc6C.gif" width="577" height="144"></li>
  </ul>
  </li>
  <li>To test the the COM object, create new <span id="intelliTXT0">&quot;Win32
  Console Application&quot; </span>project for example.<br />
  <img border="0" src="Res/ComAtlVc6B.gif" width="388" height="92" /></li>
  <li>Insert following code in the file
  <a href="../TestComContainer/Src/main.cpp">
  <img border="0" src="../../../../../Doc/Symbol/externS.gif" width="8" height="8"></a>
  created by the project wizard:<br />
  <pre><code>//Files generated by MIDL compiler
#include &quot;TestAtlCom.h&quot;
#include &quot;TestAtlCom_i.c&quot; //CLSID_TestAtlObj
//or to load the typelib from the dll
//#import &quot;TestAtlCom.dll&quot; no_namespace
/////////////////////////////////////////////////////////////////////////////
#ifdef _MSC_VER     /*Microsoft Visual Studio C/C++ compiler                 */
  #ifndef _CONSOLE
    #error &quot;define _CONSOLE macro in the project&quot;
  #endif
#endif

//-----------------------------------------------------------------------------
/*Test ATL COM container.
  Defines the entry point for the console application.

  Returns: EXIT_SUCCESS, which represents a value of 0, if successful. Otherwise
  a non-zero error code is returned.

  Note: uses Active Template Library (ATL);
        Microsoft Windows specific (Win32).
 */
int _tmain(int argc,      //[in] specifies how many arguments are passed to the
                          //program from the command line. The value of argc is
                          //at least one: the program name.
           TCHAR* argv[], //[in] the program arguments as an array of pointers
                          //to null-terminated strings. The first string
                          //(argv[0]) is the program name. The end of the array
                          //(argv[argc]) is indicated by a NULL pointer.
           TCHAR* envp[]  //[in] the user&#39;s environment variables as a pointer
                          //to an array of null-terminated strings. The end of
                          //the array is indicated by a NULL pointer.
                          //Note: Microsoft Windows specific (Win).
           )
{
int nRetCode = EXIT_SUCCESS;



std::cout &lt;&lt; &quot;Creating COM object...&quot; &lt;&lt; std::endl;
HRESULT hResult = CoInitialize(NULL); //Initialize COM
if(SUCCEEDED(hResult))
  {
  ITestAtlObj* pcomTest = NULL;
  hResult = CoCreateInstance( CLSID_TestAtlObj,
                              NULL,
                              CLSCTX_INPROC_SERVER,
                              IID_ITestAtlObj,
                              (void**)&amp; pcomTest);

  if(SUCCEEDED(hResult))
    {
    long lResult;
    pcomTest-&gt;TestMethod(7, &amp;lResult);
    std::cout &lt;&lt; &quot;2 * 7 = &quot; &lt;&lt; lResult &lt;&lt; std::endl;
    pcomTest-&gt;Release();
    }
  else
    {
    std::cout &lt;&lt; &quot;CoCreateInstance() failed!&quot; &lt;&lt; std::endl;
    }
  }

CoUninitialize(); //Uninitialize COM

return nRetCode;
}</code></pre>
  </li>
  <li>Compile and run the test application. Expected output is:<br />
  <table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="31%">
    <tr>
      <td width="100%" bgcolor="#000000"><font color="#FFFFFF"></font>
      <pre><font color="#FFFFFF">C:\&gt;TestComContainer.exe
Creating COM object...
2 * 7 = 14
C:\&gt;</font></pre>
      <font color="#FFFFFF"></font></td>
    </tr>
  </table>
  </li>
  </ol>
  <hr />
  <p><a name="Footnote1" class="Footnote" id="ID_FOOTNOTE1"><sup>1</sup></a>Active
  Template Library (ATL) is Microsoft C++ library usually used to create ActiveX and
  other software components based on Component Object Model.<br />
  <a name="Footnote2" class="Footnote" id="ID_FOOTNOTE2"><sup>2</sup></a>Component
  Object Model (COM) defines how an object exposes its functionality, allowing to be
  accessed from other processes and across networks.</p>

  </body>

  </html>