$RCSfile: S:\_SrcPool\Cpp\Win\Samples\TestComAtl\TestComAtl.txt$: developer's note
$Revision: 1$ $Date: 2007-03-05 17:32:18$
$Author: Darko Kolakovic$

Samples and test suites for the Component Object Model (COM), Active Template Library (ATL) and Microsoft Windows API.

Copyright: CommonSoft Inc.
2006-08-25 Darko Kolakovic

JavaScript Notes:
-----------------
Requirements: HTML browser supporting ActiveX

Visual C/C++ 6.0 Notes
----------------------
Include directory <Test COM>\idl\ with MIDL generated files in order to create the container.
Also <Test COM>.dll have to be registered:
  regsvr32 <Test COM>.dll

Visual Studio .Net 2003 v7.1 Notes
------------------------------------------
The project is created with VC/C++ 6.0 and converted to v7.1. Output directories are changed to:
  $(SolutionDir)bin\$(ConfigurationName)\$(PlatformName)
  $(SolutionDir)Obj\$(ConfigurationName)\$(ProjectName)\$(PlatformName)
  $(OutDir)/$(ProjectName).pdb
  $(OutDir)/$(ProjectName).lib
  $(IntDir)/TestComAtl.tlb
  $(OutDir)/$(ProjectName).bsc

Post-Build step
---------------
Proxy/Stub dll is created with the command-line tools as the last step in the build.
Post-build step is changed to:

	@echo Build Proxy/Stub DLL
	nmake -f TestComAtlps.mk
	if errorlevel 1 goto ERR_LVL1
	goto S_OK
	:ERR_LVL1
	echo Post-Build(4) : warning : $(TargetName)PS failed to build!
	goto VCReportError
	:S_OK

Proxy/Stub dll build requires some auto-generated files from the $(ProjectDir) and $(ProjectDir)/idl

Visual Studio .Net 2005 8.0 Notes
----------------------------------------
  COM Bug: some of our classes are causing C4701 warnings from the "injected" attribute code
      "warning C4701: potentially uninitialized local variable 'pp' used"
      The code is "injected" from the ATL library; pp variable is not initialized if an exception happens.
      You have a few options to workaround the warning:

      1. Disable the warning globally. Specifying /wd4701 on the compiler command line

      2. Surround the class with event_source attribute with #pragma warning to disable the warning.
            #pragma warning(push, 4)
            #pragma warning(disable : 4701)
            [... event_source(com) ]
            class CSource : ...
            {
                public:
                 __event __interface ...;
            ...
            };    // CSource
            #pragma warning(pop)

        This will disable warning just in the class.

      3. Disable the warning around the code generated for attributes by adding the pragmas as below
            [... event_source(com) ]
            class CSource : ...
            {
                public:
                 __event __interface ...;
            ...
            #pragma warning(push, 4)
            #pragma warning(disable : 4701)
            };    // CSource
            #pragma warning(pop)


Partial Assembly failed for Microsoft.VC80 CRT
---------------------------------------------------
While running the debug (or release) version of the application, following message apears:
  "This application has failed to start because the application configuration is incorrect.
    Reinstalling the application may fix this problem."

Event log have next entries:
  "Resolve Partial Assembly failed for Microsoft.VC80.DebugCRT.
   Reference error message: The referenced assembly is not installed on your system."
and
  "Generate Activation Context failed for \\?\C:\ISAPI\Content Control\IIS_Content_Control.dll.
   Reference error message: The referenced assembly is not installed on your system."

When Visual Studio is installed, these libraries are place in the Windows Side-By-Side (SxS)
assembly cache, meaning they will always be found by an application when run on the machine
with MSVC installed.
The merge modules (.msm) should also be doing the same thing. 
It is possible that the merge modules are for an older version of the CRT/MFC runtimes.
If this is the case, rebuild application with current version of CRT libraries.

Solution:
  - Debug build
    1. Install Visual Studio 2005 on the target machine. 
       This will install the necessary MSVCR80D.DLL etc to the WinSxS folder or
    2. copy the contents (including manifest) of the
        %PROGFILES%\microsoft visual studio 8\vc\redist\Debug_NonRedist\x86\Microsoft.VC80.DebugCRT
       and
        %PROGFILES%\microsoft visual studio 8\vc\redist\Debug_NonRedist\x86\Microsoft.VC80.DebugMFC
       folders to the same folder as your built DLL.
    3. Create a small setup that includes microsoft_vc80_debugcrt_x86.msm MSM merge module from
       "%PROGFILES%\common files\merge modules\" directory and run created setup on the target machine.
       Ref.: http://msdn2.microsoft.com/en-us/library/ms235285(en-US,VS.80).aspx

  - Release build
    1. Install MSVC80 CRT assembly on the target machine by executing vcredist_x86.exe from
        %PROGFILES%Microsoft Visual Studio 8\SDK\v2.0\BootStrapper\Packages\vcredist_x86\
    2. Copy the contents of 
        %PROGFILES%\Microsoft Visual Studio 8\VC\redist\x86\Microsoft.VC80.MFC 
       to the same folder as your DLL.
    3. Create a small setup that includes Microsoft_VC80_MFC_x86.msm MSM merge module from
       "%PROGFILES%\common files\merge modules\" directory and run created setup on the target machine.
       To create setup project:
        a. open Visual Studio and created a Regular Setup Project
        b. add the required Merge Modules (.msm) from "%PROGFILES%\common files\merge modules\" 
           to the project
        c. buid the deployment project


\	TestComAtlps.mk	Microsoft Program Maintenance Utility -nmake (mk) file format version 5.0.	Win32
\	TestComAtl.dsp	Microsoft Developer Studio Project (DSP) file is a generated build file, format version 6.00 (MSVC6).	Win32
\	TestComAtl.vcproj Microsoft Developer Studio .Net Project (VcProj) file is a generated build file, format version 8.0 (MSVC8 2005).	Win32
\	TestComAtl7.vcproj Microsoft Developer Studio .Net Project (VcProj) file is a generated build file, format version 7.10 (MSVC7 2003).	Win32
