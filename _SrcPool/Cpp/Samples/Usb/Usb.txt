$RCSfile: Usb.txt,v $: developer's note
$Revision: 1.6 $ $Date: 2009/08/19 21:09:37 $
$Author: ddarko $

Usb

Microsoft Windows Console Application

Dependencies:
    Windows DDK (hidsdi.h) version 3790.1830 (Win2k or WinXP)
                 hid.lib   version 3790.1830 (Win2k or WinXP)
    Note: Windows DDK header and libarary are replaced with Open Watcom Project (OWP) files.
                     
    MSCVC/C++ 6.0
      To add new search path for DDK header files and libraries, select menu item:
      Tools| Options... | Directories
        Show directories for: Include files
      add new directory with DDK header files
        Choose Directory: WinDDK\3790.1830\inc\wxp (or WinDDK\3790.1830\inc\ddk\wdm\wxp)

        Show directories for: Library files
      add new directory with DDK libraries
        Choose Directory: WinDDK\3790.1830\lib\wxp\i386

    Standard Template Library (STL)
      To include STL string header files through the precompiled header, define _USE_STL.

main.cpp
    This is the main application source file.
StdAfx.h, StdAfx.cpp
    These files are used to build a precompiled header (PCH) file
    named Usb.pch and a precompiled types file named StdAfx.obj.


If the following error occurs while building debug version of the project with Microsoft Visual C/C++ 6.0
  warning LNK4098: defaultlib "LIBC" conflicts with use of other libs;
clean all object files and recompile agani the project.

Target Microsoft Windows (MFC/GUI subsystem:windows) requires MFC library, _WINDOWS preprocessor definition, /subsystem:windows linker option (Microsoft Visual C/C++).
If MFC TestDocument/TestView framework is used, it is required to initialize global test entry point:
    PFUNCENTRY_TEST g_startTest = MyTestFunc;
This is not required if the target is Windows console (subsystem:console).

\	Usb.dsp	Microsoft Developer Studio Project (DSP) file is a generated build file, format version 6.00 (MSVC6).	Win32
\	Usb7.vcproj	Microsoft Developer Studio .Net 2003 Project (vcproj) file is a generated build file, format version 7.10 (MSVC7.3).	Win32
\	Usb.vcproj	Microsoft Developer Studio 2005 Project (vcproj) file is a generated build file, format version 8 (MSVC8).	Win32


MSCVC/C++ 6.0 Notes
-------------------
  For Unicode builds both _UNICODE and UNICODE have to be defined because of botched Microsoft header files.

  STL shipped with MSVC 6.0 prodices number of compiler warnings. To suppress the warnings insert pragmas in following files:
    visualstudio.6\vc98\include\xlocale
      #pragma warning(disable: 4018 4100 4511 4512 4663 4710)
        //warning C4018: signed/unsigned mismatch
        //warning C4100: unreferenced formal parameter
        //warning C4511: copy constructor could not be generated
        //warning C4512: assignment operator could not be generated
        //warning C4663: C++ language change
        //warning C4710: function not inlined (Release build)
        ...
      #pragma warning(default: 4018 4100 4511 4512 4663 4710)
    visualstudio.6\vc98\include\ostream
      #pragma warning(disable: 4018 4512 4710)
        //warning C4018: signed/unsigned mismatch
        //warning C4512: assignment operator could not be generated
        //warning C4710: function not inlined (Release build)
        ...
      #pragma warning(default: 4018 4512 4710)
    visualstudio.6\vc98\include\xlocnum
      #pragma warning(disable: 4018 4511 4512 4710)
        //warning C4018: signed/unsigned mismatch
        //warning C4511: copy constructor could not be generated
        //warning C4512: assignment operator could not be generated
        //warning C4710: function not inlined (Release build)
        ...
      #pragma warning(default: 4018 4511 4512 4710)
    visualstudio.6\vc98\include\streambuf
      #pragma warning(disable: 4100)
        //warning C4100: unreferenced formal parameter
        ...
      #pragma warning(default: 4100)
    VisualStudio.6\VC98\INCLUDE\utility
      #pragma warning(disable: 4710)
        //warning C4710: function not inlined (Release build)
        ...
      #pragma warning(default: 4710)
    VisualStudio.6\VC98\INCLUDE\xstring
      #pragma warning(disable: 4710)
        //warning C4710: function not inlined (Release build)
        ...
      #pragma warning(default: 4710)
    VisualStudio.6\VC98\INCLUDE\xlocinfo
      #pragma warning(disable: 4710)
        //warning C4710: function not inlined (Release build)
        ...
      #pragma warning(default: 4710)
    VisualStudio.6\VC98\INCLUDE\typeinfo
      #pragma warning(disable: 4710)
        //warning C4710: function not inlined (Release build)
        ...
      #pragma warning(default: 4710)
    visualstudio.6\vc98\include\istream
      #pragma warning(disable: 4701)
        //warning C4701: local variable may be used without having been initialized
        ...
      #pragma warning(default: 4701)

Win DDK
-------
  To fix warning in DDK version 3790.1830
        hidpi.h(1702) : warning C4201: nonstandard extension used : nameless struct/union
  insert in <hidpi.h>
    #pragma warning(disable: 4201) //warning C4201: nonstandard extension used : nameless struct/union
    ...
    #pragma warning(default: 4201)


  Microsoft devcon utility (from Windows DDK) fails to change the state of the device if change is disallowed.
    C:>devcon disable *VID_05E0*
    HID\VID_05E0&PID_1200\6&212AFFF5&0&0000                     : Disable failed
    USB\VID_05E0&PID_1200\S/N:E58C41CCE31CC946B019A5C1DA549003_REV:NBRPVAAK3: Disable failed
    No devices disabled.

  To allow it, create Windows Registry DWORD value:
    HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Kbdclass\Parameters\AllowDisable

  Note: Windows DDK header and libarary are replaced with Open Watcom Project (OWP) files.

LibUsb-Win32 Generic Windows USB Library
----------------------------------------  
LibUsb-Win32 is a port of the USB library libusb (http://sf.net/projects/libusb/) to the Windows operating system (Win98SE, WinME, Win2k, WinXP).
The library allows user space applications to access any USB device on Windows.
http://libusb-win32.sourceforge.net

Installation
Filter Driver Installation

    * As of version 0.1.7.10 the filters driver is installed by a user friendly GUI installer which makes the install and uninstall process easier and more secure.
    * Log in as a user with administrator privileges.
    * Download the latest filter driver installer (libusb-win32-filter-bin-x.x.x.x.exe).
    * Close all applications which use USB devices before installing.
    * Run the installer, and follow it's instructions. Do not run the installer from an USB storage device!
    * At the end of the installation process the installer will offer to run a test program. This program will verify the correct installation and print the descriptors of all USB devices accessible by the library. The test program can also be run later from the system's start menu.
    * A reboot isn't necessary.

Device Driver Installation

    * As of version 0.1.7.10 the device driver is distributed as a seperate package which includes everything to use libusb-win32 for single devices as a normal device driver. The installation of the filter driver is not necessary any more!
    * Log in as a user with administrator privileges.
    * Download the latest device driver binary package (libusb-win32-device-bin-x.x.x.x.tar.gz).
    * Extract it to a temporary directory.
    * Rename and edit the sample inf-file 'libusb.inf' to match your device(s) (modify the vendor and product IDs, strings etc.). Create different inf-files to install different types of devices (devices with different IDs).
    * Unplug the device(s) from the system.
    * Open the Windows Device Manager and remove all incorrectly installed USB devices (device entries with a yellow exclamation mark).
    * Reconnect the device(s) to the system.
    * When Windows asks for a driver, choose the inf-file(s) created above. On Win2k and WinXP systems, Windows will warn that the driver is is not 'digitally signed'. Ignore this message and continue with the installation.
    * Open the Windows Device Manager to verify that the device is installed correctly. Run the test program (testlibusb-win.exe) from the 'bin directory'. It should print out the descriptors of your device(s).
    * A reboot isn't necessary.

Features:

    * Can be used as a filter driver for existing, already installed devices. This feature allows libusb-win32 to communicate with any installed USB device.
    * Can be used as a normal device driver for devices for which no driver exists (self build/developed USB hardware, etc).
    * The two methods described above can used in parallel without any problems.
    * 100% API and functional compatible with the main libusb project.
    * Supports Bulk and Interrupt transfers.
    * Supports all Standard Device Requests (control messages) described in chapter 9 of the USB specification.
    * Supports vendor specific control messages.

  